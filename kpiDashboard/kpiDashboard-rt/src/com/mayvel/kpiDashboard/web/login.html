<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuration</title>
    <style>
html, body {
    height: 100%;
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f6fa;
}
.top-bar {
    width: 100%;
    background: #2f3640;
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 100;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
.top-bar h1 { margin-left: 15px; font-size: 20px; }
.logout-btn {
    margin-right: 15px;
    padding: 8px 16px;
    background: #e84118;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
}
.logout-btn:hover { background: #c23616; }

.container {
    display: flex;
    height: calc(100% - 120px);
    margin-top: 60px;
    gap: 20px;
    padding: 20px;
    box-sizing: border-box;
}
.left-column, .right-column {
    flex: 1;
    display: flex;
    flex-direction: column;
    height: 100%;
}
.left-column h2, .right-column h2 { text-align: center; margin-bottom: 10px; color: #2f3640; }
#searchBox, #searchSelected {
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #dcdde1;
    margin-bottom: 10px;
    font-size: 16px;
}
#pointsDropdown, #selectedPoints {
    flex: 1;
    padding: 5px;
    border-radius: 6px;
    border: 1px solid #dcdde1;
    font-size: 16px;
    overflow-y: auto;
}

.dropdown-option {
    padding: 8px;
    margin: 3px 0;
    border-radius: 16px;
    cursor: pointer;
    transition: background 0.2s;
}
.dropdown-option:hover {
    background-color: #4cd137;
}
.dropdown-option.selected {
    background-color: #4cd137;
    color: #2f3640;
}

.selected-points {
    display: flex;
    flex-direction: column;
    gap: 10px;
    overflow-y: auto;
    padding: 5px;
    border: 1px solid #dcdde1;
    border-radius: 8px;
    background: #f1f2f6;
    box-sizing: border-box;
}
.point-chip {
    background: #4cd137;
    color: white;
    padding: 8px 12px;
    border-radius: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.point-chip button {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    font-weight: bold;
}

.save-btn-container {
    width: 100%;
    text-align: center;
    padding: 15px 0;
    position: fixed;
    bottom: 0;
    left: 0;
    background: #f5f6fa;
}
.save-btn {
    padding: 12px 30px;
    background: #0097e6;
    color: white;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
}
.save-btn:hover { background: #007bb8; }
</style>
</head>
<body>

<div class='top-bar'>
    <h1>Http Server Driver</h1>
    <button class='logout-btn' onclick='logout()'>Logout</button>
</div>

<div class='container'>
    <div class='left-column'>
        <h2>Configuration</h2>
        <input type='text' id='searchBox' placeholder='Search points...'>
        <div id="pointsDropdown"></div>
    </div>
    <div class='right-column'>
        <h2>Selected Points</h2>
        <input type='text' id='searchSelected' placeholder='Search selected points...'>
        <div class='selected-points' id='selectedPoints'></div>
    </div>
</div>

<div class="save-btn-container">
    <button class="save-btn" onclick="saveChanges()">Save Changes</button>
</div>

<script>
function logout() { alert('Logged out'); }

const selectedPointsMap = new Map();
const dropdown = document.getElementById('pointsDropdown');
const selectedContainer = document.getElementById('selectedPoints');
const searchBox = document.getElementById('searchBox');
const searchSelected = document.getElementById('searchSelected');

function populateDropdown(points) {
    dropdown.innerHTML = '';
    points.forEach(point => {
        const div = document.createElement('div');
        div.className = 'dropdown-option';
        div.textContent = point.pointName + ' (' + point.type + ')';
        div.dataset.value = point.pointName;
        div.onclick = () => toggleSelect(point.pointName, div);
        dropdown.appendChild(div);
    });
}

function toggleSelect(value, div) {
    if(selectedPointsMap.has(value)) {
        selectedPointsMap.delete(value);
    } else {
        selectedPointsMap.set(value, div.textContent);
    }
    renderSelectedPoints();
    highlightDropdown();
}

function renderSelectedPoints() {
    selectedContainer.innerHTML = '';
    selectedPointsMap.forEach((label, value) => {
        const chip = document.createElement('div');
        chip.className = 'point-chip';
        chip.textContent = label;
        const btn = document.createElement('button');
        btn.textContent = 'Ã—';
        btn.onclick = () => {
            selectedPointsMap.delete(value);
            renderSelectedPoints();
            highlightDropdown();
        };
        chip.appendChild(btn);
        selectedContainer.appendChild(chip);
    });
}

function highlightDropdown() {
    Array.from(dropdown.children).forEach(div => {
        if(selectedPointsMap.has(div.dataset.value)) {
            div.classList.add('selected');
        } else {
            div.classList.remove('selected');
        }
    });
}

searchBox.addEventListener('input', e => {
    const filter = e.target.value.toLowerCase();
    Array.from(dropdown.children).forEach(div => {
        div.style.display = div.textContent.toLowerCase().includes(filter) ? 'block' : 'none';
    });
});

searchSelected.addEventListener('input', e => {
    const filter = e.target.value.toLowerCase();
    Array.from(selectedContainer.children).forEach(div => {
        div.style.display = div.textContent.toLowerCase().includes(filter) ? 'flex' : 'none';
    });
});

function saveChanges() {
    const selected = Array.from(selectedPointsMap.keys());
    alert('Saved Points: ' + selected.join(', '));
}

// Fetch original points from server
async function fetchPoints() {
    try {
        const token = localStorage.getItem('token'); // if auth required
        const res = await fetch('/getPoints', {
            headers: { 'Authorization': 'Bearer ' + token }
        });
        const data = await res.json();
        if(data.status === 'success') {
            populateDropdown(data.points);
        } else {
            alert('Failed to fetch points');
        }
    } catch(err) {
        console.error(err);
        alert('Server error');
    }
}

fetchPoints();
</script>

</body>
</html>
